@using System.Web
@model THECinema.Web.ViewModels.Movies.FullInfoMovieViewModel
@{
    ViewData["Title"] = "Details";

    var url = Model.TrailerVideoUrl;
    var uri = new Uri(url);
    var query = HttpUtility.ParseQueryString(uri.Query);
    var videoId = query["v"];
}
<link href="~/css/details.css" rel="stylesheet" asp-append-version="true" />
<link href="~/lib/fontawesome/css/all.css" rel="stylesheet" asp-append-version="true" />

<h1 class="text-center">@Model.Name</h1>

<div class="clearfix">
    <div class="box" id="imgBox">
        <img class="float-left" src="@Model.TrailerUrl" />
    </div>
    <div class="box" id="middleBox">
        <h5>Director</h5>
        <h7>@Model.Director</h7>
        <h5>Actors</h5>
        <h7>@Model.Actors</h7>
        <h5>Resume</h5>
        <p>@Model.Description</p>
        <h5>IMDb Rating</h5>
        <p>@Model.Rating</p>
    </div>
    <div class="box">
        <h5>Duration</h5>
        <h7>@Model.Duration minutes</h7>
        <h5>Year</h5>
        <h7>@Model.Year</h7>
        <h5>Genre</h5>
        <h7>@Model.Genre</h7>
        <hr />
        <a href="#trailer" id="trailerBtn" class="btn btn-warning">WATCH TRAILER</a>
        <a href="/Projections/GetById?filmId=@Model.Id" id="bookBtn" class="btn btn-success">BOOK TICKET</a>
        <hr />
        <a href="#writeReviewForm" class="btn btn-outline-secondary writeReviewBtn">WRITE REVIEW</a>
    </div>
</div>

<div id="trailer">
    <iframe width="960" height="480"
            src="https://www.youtube.com/embed/@videoId">
    </iframe>
</div>

<h2 class="text-center">Reviews</h2>

@if (!Model.Reviews.Any())
{
    <h5 align="center">There are still no reviews for this movie.</h5>
    <a align="center" href="#" class="writeReviewBtn"><h5>Be the first one to write a review!</h5></a>
}

<div>
    <form asp-controller="Reviews" asp-action="Add" method="post" id="writeReviewForm" style="display: none">

        <div class="stars form-group">
            <input type="radio" id="star5" name="Stars" value="5" />
            <label for="star5" title="5 stars"></label>
            <input type="radio" id="star4" name="Stars" value="4" />
            <label for="star4" title="4 stars"></label>
            <input type="radio" id="star3" name="Stars" value="3" />
            <label for="star3" title="3 stars"></label>
            <input type="radio" id="star2" name="Stars" value="2" />
            <label for="star2" title="2 stars"></label>
            <input type="radio" id="star1" name="Stars" value="1" />
            <label for="star1" title="1 star"></label>
        </div>

        <div class="form-group">
            <label for="Title">Title</label>
            <input Name="Title" class="form-control" />
        </div>
        <div class="form-group">
            <label for="Content">Content</label>
            <textarea name="Content" id="content" class="form-control"></textarea>
        </div>
        <hr />
        <input type="hidden" name="MovieId" value="@Model.Id" />
        <div>
            <input type="submit" class="btn btn-success" value="Add Review" />
        </div>
    </form>
</div>

<hr />

@foreach (var review in Model.Reviews)
{
    @if (review.Stars == 0)
    {
        review.Stars = 1;
    }

    <div class="card">
        <div class="card-header">
            @review.ApplicationUserUserName
            <div class="float-right">
                @for (int i = 0; i < 5; i++)
                {
                    if (review.Stars > 0)
                    {
                        <span class="fa fa-star checked"></span>
                        review.Stars--;
                    }
                    else
                    {
                        <span class="fa fa-star"></span>
                    }
                }
            </div>
        </div>
        <div class="card-body">
            <h5 class="card-title">@review.Title</h5>
            <p class="card-text">@Html.Raw(review.Content)</p>
            <a href="#" class="btn btn-outline-success float-right">Comment</a>
        </div>
    </div>
}


<style>
    .card {
        margin-bottom: 5px;
        padding-bottom: 5px;
    }

    #trailer {
        margin-left: 6%;
    }

    #trailer {
        display: none;
    }

    .checked {
        color: orange;
    }

    .stars:not(:checked) > input {
        opacity: 0;
    }

    .stars:not(:checked) > label {
        float: right;
        width: 1em;
        overflow: hidden;
        white-space: nowrap;
        cursor: pointer;
        font-size: 30px;
        color: #ccc;
    }

        .stars:not(:checked) > label:before {
            content: '★ ';
        }

    .stars > input:checked ~ label {
        color: #ffc700;
    }

    .stars:not(:checked) > label:hover,
    .stars:not(:checked) > label:hover ~ label {
        color: #deb217;
    }

    .stars > input:checked + label:hover,
    .stars > input:checked + label:hover ~ label,
    .stars > input:checked ~ label:hover,
    .stars > input:checked ~ label:hover ~ label,
    .stars > label:hover ~ input:checked ~ label {
        color: #c59b08;
    }
</style>

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="/lib/tinymce/tinymce.min.js" type="text/javascript"></script>

<script type="text/javascript">
    tinymce.init({
        selector: "textarea",
        plugins: ["image paste table link code media"]
    });
</script>

<script>

    $(".writeReviewBtn").click(function () {
        $("#writeReviewForm").show();
        $('html, body').animate({
            scrollTop: $("#writeReviewForm").offset().top
        }, 500);
    });


    $("#trailerBtn").click(function () {
        $("#trailer").toggle();
        $('html, body').animate({
            scrollTop: $("#trailer").offset().top
        }, 500);
    });
</script>
